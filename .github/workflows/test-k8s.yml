name: Test Kubernetes Commands

on:
  push:
    branches:
      - main

jobs:
  test-k8s:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Create kubeconfig directory
      run: mkdir -p $HOME/.kube

    - name: Set up Kubeconfig
      run: echo "${{ secrets.KUBECONFIG }}" > $HOME/.kube/config

    - name: Add controlplane entry to hosts file
      run: echo "192.24.175.3 controlplane" | sudo tee -a /etc/hosts

    - name: Install kubectl
      run: |
        curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x ./kubectl
        sudo mv ./kubectl /usr/local/bin/kubectl

    - name: Test Kubernetes Connection
      run: kubectl get nodes
